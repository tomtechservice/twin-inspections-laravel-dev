<app-panel [page_title]='page_title'></app-panel>
<div class="intake-tab-content">
  <div class="row pb-2 pt-4 intab-content">
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-6">
          <h4 class="h4-heading">Work Completion</h4>
        </div>
        <div class="col-md-6">
          <span class="float-right">
            <ng-container *ngIf="!is_loading && (report && report?.report_change_status) ">
              <div ngbDropdown class="d-inline-block">
                <button class="btn btn-outline-danger" id="dropdownBasic1" ngbDropdownToggle><i class="fa fa-warning anim-swing"></i>
                  Action Required</button>
                <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                  <button class="dropdown-item-warning">
                    <a routerLink="/inspections-profile-findings/{{jobId}}">
                      Changes have been made<br />
                      to the report and re-generation<br />
                      of the PDFs is required<br />
                      Goto Findings
                    </a>
                  </button>
                </div>
              </div>
            </ng-container>
            &nbsp;&nbsp;
            <button class="btn quick-view-btn" type="button" data-toggle="tooltip" title="Generate Reports and Job Docs"
              (click)="reportManagerOpen()">
              <i class="fa fa-file"></i> Reports: Quick View
            </button>
          </span>
        </div>
      </div>
      <ng-container *ngIf="is_loading; then load else not_load">
      </ng-container>
      <ng-template #load>
        <div class="loader"></div>
      </ng-template>
      <ng-template #not_load>
        <form [formGroup]="completionForm" (ngSubmit)="onSubmit()">
          <h3 class="subtit">Findings</h3>
          <br>
          <br>
          <div class="table">
            <table class="table table-striped table-hover fill-head">
              <ng-container *ngIf="!is_loading && findingWithOutChemicals?.length >0; then chemical_data  else chemical_no_data ">
              </ng-container>
              <ng-template #chemical_no_data>
                <tr>
                  <th>
                    <div class="text-center">
                      No Findings
                    </div>
                  </th>
                </tr>
              </ng-template>
              <ng-template #chemical_data>
                <tr>
                  <th>
                    <div class="text-center">
                      Section<br>
                      (1-3)
                    </div>
                  </th>
                  <th>
                    <div class="text-center">
                      Type<br>
                      (1-5)
                    </div>
                  </th>
                  <th>
                    <div class="text-center">
                      Finding<br>
                      (A-Z)
                    </div>
                  </th>
                  <th>
                    <div class="text-center">
                      Bid<br>
                      <span style="font-weight:normal; font-size: 11px;">
                        * with discount applied
                      </span>
                    </div>
                  </th>
                  <th>
                    <div class="text-center">
                      View
                    </div>
                  </th>
                  <th>
                    Crew<br>
                    <div>
                      <div ngbDropdown class="d-inline-block">
                        <button type="button" class="btn btn-outline-dark" id="dropdownBasic1" ngbDropdownToggle><i
                            class="fa fa-thumb-tack"></i>
                          Fill All</button>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                          <ul style="overflow: hidden;max-height: 350px;overflow-y: auto;">
                            <li>
                              <div style="border-bottom: #d3d3d3 solid 2px; font-weight:bold;">Crew &nbsp;&nbsp;&nbsp;<span
                                  style="font-size: 11px;">(Treaters *)</span></div>
                            </li>
                            <ng-container *ngFor="let item of assigneeData.crew">
                              <ng-container *ngIf="item.user_is_treater==1; else no_crew_treater ">
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'findings')">*&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-container>
                              <ng-template #no_crew_treater>
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'findings')">&nbsp;&nbsp;&nbsp;&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-template>
                            </ng-container>
                            <li>
                              <div style="border-bottom: #d3d3d3 solid 2px; font-weight:bold;">Contractor</div>
                            </li>
                            <ng-container *ngFor="let item of assigneeData.contractor">
                              <ng-container *ngIf="item.user_is_treater==1; else no_treater_contractor ">
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'findings')">*&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-container>
                              <ng-template #no_treater_contractor>
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'findings')">&nbsp;&nbsp;&nbsp;&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-template>
                            </ng-container>
                            <li>
                              <div style="border-bottom: #d3d3d3 solid 2px; font-weight:bold;">Inspectors</div>
                            </li>
                            <ng-container *ngFor="let item of assigneeData.inspector">
                              <ng-container *ngIf="item.user_is_treater==1; else no_treater_inspector ">
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'findings')">*&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-container>
                              <ng-template #no_treater_inspector>
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'findings')">&nbsp;&nbsp;&nbsp;&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-template>
                            </ng-container>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </th>
                  <th>
                    Hours
                  </th>
                  <th>
                    Materials
                  </th>
                  <th>
                    Date Completed
                    <div>           
                      <div class="btn-group" role="group" aria-label="Basic example">         
                          <button type="button" class="btn btn-secondary"><li class="fa fa-thumb-tack"></li> Fill All</button>
                          <input style="width:0px; border: 0px;" class="calendar-contol" placeholder="mm/dd/yyyy" name="dp" firstDayOfWeek="7" ngbDatepicker #d="ngbDatepicker" (click)="d.toggle()" (dateSelect)="onDateChange( $event,'findings' )">
                          <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button">
                            <i class="fa fa-caret-down" aria-hidden="true"></i>
                          </button>
                      </div>
                      <!-- <div class="input-group form-date-pick">
                        <input class="calendar-contol" placeholder="mm/dd/yyyy" name="dp" firstDayOfWeek="7" ngbDatepicker #d="ngbDatepicker" (click)="d.toggle()" (dateSelect)="onDateChange( $event,'findings' )">
                        <div class="input-group-append">
                          <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button">
                            <i class="fa fa-calendar" aria-hidden="true"></i>
                          </button>
                        </div>
                      </div> -->
                      <!-- <div  ngbDropdown class="d-inline-block">
                        <button type="button" class="btn btn-outline-dark" id="dropdownBasic1" ngbDropdownToggle><i
                            class="fa fa-thumb-tack"></i>
                          Fill All
                        </button>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                            <ngb-datepicker   (select)="onDateChange( $event,'findings' )"></ngb-datepicker>
                        </div>
                      </div> -->
                    </div>
                  </th>
                  <th>
                    <label for="checkboxall">Mark Completed</label>
                    <!-- <input name="" type="checkbox" value="" id="checkboxall" onchange="check_all_boxes_completion('fids');"> -->
                  </th>
                  <th>
                    <label for="checkboxall">Mark Partially Completed</label>
                    <!-- <input name="" type="checkbox" value="" id="checkboxall" onchange="check_all_boxes_completion('fids');"> -->
                  </th>
                </tr>
                <ng-container *ngIf="!is_loading && findingWithOutChemicals">
                  <ng-container formArrayName="findingWithOutChemicals" *ngFor="let item of completionForm?.get('findingWithOutChemicals').controls; let i = index;">
                    <ng-container [formGroupName]="i">
                      <tr>
                        <td>
                          <div class="text-center">
                            {{item.value.finding_section}}
                          </div>
                        </td>
                        <td>
                          <div class="text-center">
                            {{item.value.finding_type}}
                          </div>
                        </td>
                        <td>
                          <div class="text-center">
                            {{item.value.finding_finding}}
                          </div>
                        </td>
                        <td class="min_100">
                          <ng-container *ngIf="item.value.bid.type == 'NO BID';else no_bid">
                            {{item.value.bid.type}}<br>
                            <span style="font-size:11px;">
                              {{item.value.bid.value}}
                            </span>
                          </ng-container><br>
                          <ng-template #no_bid>
                            <span *ngIf="item.value.bid?.discount == 'discount';else no_discount">
                              {{item.value.bid.value | currency}} *
                            </span>
                            <ng-template #no_discount>{{item.value.bid.value | currency}}</ng-template>
                          </ng-template>
                          <div [hidden]="!item.value.finding_partially_completed" class="form-group">
                            <div class="">
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <div class="input-group-text">$</div>
                                </div>
                                <input formControlName="partially_completed_discount" class="form-control" placeholder="0.00" type="text" value="">
                              </div>
                            </div>
                          </div>
                        </td>
                        <td>
                          <!-- <a href="javascript:;" title="View Finding" (click)="openFormModel('findings')">
                            <ng-template #tipFinding>View Finding</ng-template>
                            <button [ngbTooltip]="tipFinding" class="btn btn-dark btn-circle btn-lg" type="button">
                              <i class="fa fa-list-alt"></i>
                            </button>
                          </a> -->
                          <button class="btn btn-dark btn-sm btn-r-ound" type="button" ngbTooltip="View Finding" (click)='viewFinding(item.value.finding_id)'>
                            <i class="fa fa-list-alt"></i>
                          </button>
                        </td>
                        <td>
                          <div >
                            <select formControlName="finding_perform_crew_id" class="form-control"  style="padding:0.375rem 0.75rem;">
                              <option value="0">---Select---</option>
                              <optgroup label="Crew &nbsp;&nbsp;( * Treaters )">
                                <ng-container *ngFor="let crewData of assigneeData.crew">
                                  <option *ngIf='crewData.user_is_treater==1' [ngValue]="crewData.user_id">*&nbsp;
                                    {{crewData.user_last_name}},{{crewData.user_first_name}}</option>
                                  <option *ngIf='crewData.user_is_treater!=1' [ngValue]="crewData.user_id">&nbsp;&nbsp;&nbsp;&nbsp;
                                    {{crewData.user_last_name}},{{crewData.user_first_name}}</option>
                                </ng-container>
                              </optgroup>
                              <optgroup label="Treaters">
                                <ng-container *ngFor="let contractorData of assigneeData.treater">
                                  <option [ngValue]="contractorData.user_id">&nbsp;&nbsp;&nbsp;&nbsp;
                                    {{contractorData.user_last_name}},{{contractorData.user_first_name}}</option>
                                </ng-container>
                              </optgroup>
                              <optgroup label="Contractors">
                                <ng-container *ngFor="let contractorData of assigneeData.contractor">
                                  <option [ngValue]="contractorData.user_id">&nbsp;&nbsp;&nbsp;&nbsp;
                                    {{contractorData.user_last_name}},{{contractorData.user_first_name}}</option>
                                </ng-container>
                              </optgroup>
                              <!-- <optgroup label="Inspectors">
                                <ng-container *ngFor="let inspectorData of assigneeData.inspector">
                                  <option *ngIf='inspectorData.user_is_treater==1' [ngValue]="inspectorData.user_id">*&nbsp;
                                    {{inspectorData.user_last_name}},{{inspectorData.user_first_name}}</option>
                                  <option *ngIf='inspectorData.user_is_treater!=1' [ngValue]="inspectorData.user_id">&nbsp;&nbsp;&nbsp;&nbsp;
                                    {{inspectorData.user_last_name}},{{inspectorData.user_first_name}}</option>
                                </ng-container>
                              </optgroup> -->
                            </select>
                          </div>
                        </td>
                        <td>
                          <div class="form-group min_100">
                            <div class="" style="padding-top: 0px;">
                              <input formControlName="finding_bid_hours_completed" class="form-control" type="text"
                                value="">
                            </div>
                          </div>
                        </td>
                        <td>
                          <div class="form-group min_100">
                            <div class="">
                              <div class="input-group">
                                <div class="input-group-prepend">
                                  <div class="input-group-text">$</div>
                                </div>
                                <input formControlName="finding_bid_material_completed" class="form-control"
                                  placeholder="0.00" type="text" value="">
                              </div>
                            </div>
                          </div>
                        </td>
                        <td>
                          <div class="form-group">
                            <div class="input-group form-date-pick">
                              <input formControlName="finding_date_completed" class="form-control" placeholder="mm/dd/yyyy"
                                name="dp" firstDayOfWeek="7" ngbDatepicker #d="ngbDatepicker" (click)="d.toggle()">
                              <div class="input-group-append">
                                <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button">
                                  <i class="fa fa-calendar" aria-hidden="true"></i>
                                </button>
                              </div>
                            </div>
                          </div>
                        </td>
                        <td>
                          <div class="form-group" style="margin: 0; padding: 0;">
                            <div class="col-sm-9 col-lg-2 controls">
                              <input (click)="completionStatus(item.value.finding_completed,i,'finding_completed')"
                                formControlName="finding_completed" type="checkbox">
                            </div>
                          </div>
                        </td>
                        <td>
                          <div class="form-group" style="margin: 0; padding: 0;">
                            <div class="col-sm-9 col-lg-2 controls">
                              <input (click)="completionStatus(item.value.finding_partially_completed,i,'finding_partially_completed')"
                                formControlName="finding_partially_completed" type="checkbox">
                            </div>
                          </div>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-template>
            </table>
          </div>
          <br>
          <br>
          <br>
          <h3 class="subtit">Findings (uses chemicals)</h3>
          <br>
          <br>
          <div class="table">
            <table class="table table-striped table-hover fill-head">
              <ng-container *ngIf="!is_loading && findingWithChemicals?.length >0; then finding_chemical_data  else finding_chemical_no_data ">
              </ng-container>
              <ng-template #finding_chemical_no_data>
                <tr>
                  <td>No Data</td>
                </tr>
              </ng-template>
              <ng-template #finding_chemical_data>
                <tr>
                  <th>
                    <div class="text-center">
                      Section<br>
                      (1-3)
                    </div>
                  </th>
                  <th>
                    <div class="text-center">
                      Type<br>
                      (1-5)
                    </div>
                  </th>
                  <th>
                    <div class="text-center">
                      Finding<br>
                      (A-Z)
                    </div>
                  </th>
                  <th class="text-center">
                    Bid<br>
                    <span>* with discount applied</span>
                  </th>
                  <th>
                    Crew
                    <div>
                      <div ngbDropdown class="d-inline-block">
                        <button type="button" class="btn btn-outline-dark" id="dropdownBasic1" ngbDropdownToggle><i class="fa fa-thumb-tack"></i>
                          Fill All</button>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                          <ul style="overflow: hidden;max-height: 350px;overflow-y: auto;">
                            <li>
                              <div style="border-bottom: #d3d3d3 solid 2px; font-weight:bold;">Crew &nbsp;&nbsp;&nbsp;<span style="font-size: 11px;">(Treaters *)</span></div>
                            </li>
                            <ng-container *ngFor="let item of assigneeData.crew">
                              <ng-container *ngIf="item.user_is_treater==1; else no_crew_treater ">
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'use_chemicals')">*&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-container>
                              <ng-template #no_crew_treater>
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'use_chemicals')">&nbsp;&nbsp;&nbsp;&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-template>
                            </ng-container>
                            <li>
                              <div style="border-bottom: #d3d3d3 solid 2px; font-weight:bold;">Contractor</div>
                            </li>
                            <ng-container *ngFor="let item of assigneeData.contractor">
                              <ng-container *ngIf="item.user_is_treater==1; else no_treater_contractor ">
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'use_chemicals')">*&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-container>
                              <ng-template #no_treater_contractor>
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'use_chemicals')">&nbsp;&nbsp;&nbsp;&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-template>
                            </ng-container>
                            <li>
                              <div style="border-bottom: #d3d3d3 solid 2px; font-weight:bold;">Inspectors</div>
                            </li>
                            <ng-container *ngFor="let item of assigneeData.inspector">
                              <ng-container *ngIf="item.user_is_treater==1; else no_treater_inspector ">
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'use_chemicals')">*&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-container>
                              <ng-template #no_treater_inspector>
                                <li class="dropdown-item" (click)="ChangeSortOrder(item.user_id,'use_chemicals')">&nbsp;&nbsp;&nbsp;&nbsp;{{item.user_last_name}},{{item.user_first_name}}</li>
                              </ng-template>
                            </ng-container>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </th>
                  <th>
                    Add Chemicals Applied
                  </th>
                  <th>
                    Date Completed&nbsp;&nbsp;&nbsp;&nbsp;
                    <div>
                        <div class="btn-group" role="group" aria-label="Basic example">         
                            <button type="button" class="btn btn-secondary"><li class="fa fa-thumb-tack"></li> Fill All</button>
                            <input style="width:0px; border: 0px;" class="calendar-contol" placeholder="mm/dd/yyyy" name="dpt" firstDayOfWeek="7" ngbDatepicker #dt="ngbDatepicker" (click)="dt.toggle()" (dateSelect)="onDateChange( $event,'use_chemicals' )">
                            <button class="btn btn-outline-secondary calendar" (click)="dt.toggle()" type="button">
                              <i class="fa fa-caret-down" aria-hidden="true"></i>
                            </button>
                        </div>
                      <!-- <div class="input-group form-date-pick">
                        <input class="form-control" placeholder="mm/dd/yyyy" name="dp" firstDayOfWeek="7" ngbDatepicker
                          #d="ngbDatepicker" (click)="d.toggle()" (dateSelect)="onDateChange( $event,'use_chemicals' )">
                        <div class="input-group-append">
                          <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button">
                            <i class="fa fa-calendar" aria-hidden="true"></i>
                          </button>
                        </div>
                      </div> -->
                      <!-- <div  ngbDropdown class="d-inline-block">
                          <button type="button" class="btn btn-outline-dark" id="dropdownBasic2" ngbDropdownToggle><i
                              class="fa fa-thumb-tack"></i>
                            Fill All
                          </button>
                          <div ngbDropdownMenu aria-labelledby="dropdownBasic2">
                              <ngb-datepicker   (select)="onDateChange( $event,'use_chemicals' )"></ngb-datepicker>
                          </div>
                        </div> -->
                    </div>
                  </th>
                  <th>
                    <label for="checkboxall">Mark Completed</label>
                    <!-- <input name="" type="checkbox" value="" id="checkboxall"> -->
                  </th>
                </tr>
                <ng-container formArrayName="findingWithChemicals" *ngFor="let item of completionForm?.get('findingWithChemicals').controls; let i = index;">
                  <ng-container [formGroupName]="i">
                    <tr>
                      <td>
                        <div class="text-center">
                          {{item.value.finding_section}}
                        </div>
                      </td>
                      <td>
                        <div class="text-center">
                          {{item.value.finding_type}}
                        </div>
                      </td>
                      <td>
                        <div class="text-center">
                          {{item.value.finding_finding}}
                        </div>
                      </td>
                      <td>
                        <ng-container *ngIf="item.value.bid.type == 'NO BID';else no_bid">
                          {{item.value.bid.type}}<br>
                          <span style="font-size:11px;">
                            {{item.value.bid.value}}
                          </span>
                        </ng-container><br>
                        <ng-template #no_bid>
                          <span *ngIf="item.value.bid?.discount == 'discount';else no_discount">
                            {{item.value.bid.value | currency}} *
                          </span>
                          <ng-template #no_discount>{{item.value.bid.value | currency}}</ng-template>
                        </ng-template>
                      </td>
                      <td>
                        <select formControlName="finding_perform_crew_id" class="form-control" style="padding:5px;">
                          <option value="0">---Select---</option>
                          <optgroup label="Crew &nbsp;&nbsp;( * Treaters )">
                            <ng-container *ngFor="let crewData of assigneeData.crew">
                              <option *ngIf='crewData.user_is_treater==1' [ngValue]="crewData.user_id">*&nbsp;
                                {{crewData.user_last_name}},{{crewData.user_first_name}}</option>
                              <option *ngIf='crewData.user_is_treater!=1' [ngValue]="crewData.user_id">&nbsp;&nbsp;&nbsp;&nbsp;
                                {{crewData.user_last_name}},{{crewData.user_first_name}}</option>
                            </ng-container>
                          </optgroup>
                          <optgroup label="Treaters">
                            <ng-container *ngFor="let contractorData of assigneeData.treater">
                              <option [ngValue]="contractorData.user_id">&nbsp;&nbsp;&nbsp;&nbsp;
                                {{contractorData.user_last_name}},{{contractorData.user_first_name}}</option>
                            </ng-container>
                          </optgroup>
                          <optgroup label="Contractors">
                            <ng-container *ngFor="let contractorData of assigneeData.contractor">
                              <option [ngValue]="contractorData.user_id">&nbsp;&nbsp;&nbsp;&nbsp;
                                {{contractorData.user_last_name}},{{contractorData.user_first_name}}</option>
                            </ng-container>
                          </optgroup>
                          <!-- <optgroup label="Inspectors">
                            <ng-container *ngFor="let inspectorData of assigneeData.inspector">
                              <option *ngIf='inspectorData.user_is_treater==1' [ngValue]="inspectorData.user_id">*&nbsp;
                                {{inspectorData.user_last_name}},{{inspectorData.user_first_name}}</option>
                              <option *ngIf='inspectorData.user_is_treater!=1' [ngValue]="inspectorData.user_id">&nbsp;&nbsp;&nbsp;&nbsp;
                                {{inspectorData.user_last_name}},{{inspectorData.user_first_name}}</option>
                            </ng-container>
                          </optgroup> -->
                        </select>
                      </td>
                      <td>
                        <div class="form-group">
                          <div class="col-sm-9 col-lg-11 " style="padding-top: 0px;">
                            <ng-template #tipAddChemical>Add Chemicals Applied</ng-template>
                            <a class="btn btn-primary btn-sm btn-r-ound" [ngbTooltip]="tipAddChemical" href="javascript:;"
                              title="Add Chemicals Applied" (click)="openFormModelChemicalsApplied(item.value.finding_id)"><i
                                class="fa fa-plus"></i></a>
                          </div>
                        </div>
                        <input class="form-control" type="hidden" value="">
                      </td>
                      <td>
                        <div class="form-group">
                          <div class="input-group form-date-pick">
                            <input formControlName="finding_date_completed" class="form-control" placeholder="mm/dd/yyyy"
                              name="dp" firstDayOfWeek="7" ngbDatepicker #d="ngbDatepicker" (click)="d.toggle()">
                            <div class="input-group-append">
                              <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button">
                                <i class="fa fa-calendar" aria-hidden="true"></i>
                              </button>
                            </div>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="form-group" style="margin: 0; padding: 0;">
                          <div class="col-sm-9 col-lg-2 controls">
                            <input formControlName="finding_completed" type="checkbox">
                          </div>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="5" align="right">
                        Chemicals Applied
                      </td>
                      <td colspan="5">
                        <table class="table table-striped table-hover fill-head" style="font-size: 14px;">
                          <ng-container *ngIf="(item.value?.add_chemicals.data.length > 0);then chemicals  else  no_chemicals">
                          </ng-container>
                          <ng-template #no_chemicals>
                            <tr>
                              <td colspan="4">
                                None
                              </td>
                            </tr>
                          </ng-template>
                          <ng-template #chemicals>
                            <tr>
                              <th>Chemical Code</th>
                              <th>EPA Reg #</th>
                              <th>Amount</th>
                              <th>Unit</th>
                              <th>Cost</th>
                              <th>Date</th>
                            </tr>
                            <tr *ngFor="let chem of item.value.add_chemicals.data ">
                              <td>{{chem.chemical?.chemical_name}}</td>
                              <td>{{chem.chemical?.chemical_epa}}</td>
                              <td>{{chem.job_meta_chemical_amount | currency}}</td>
                              <td>{{chem.chemical?.chemical_measure}}</td>
                              <td>{{chem.job_meta_chemical_cost | currency}}</td>
                              <td>{{chem.job_meta_chemical_date | date:'MM-dd-yy'}}</td>
                            </tr>
                          </ng-template>
                        </table>
                      </td>
                    </tr>
                  </ng-container>
                </ng-container>
              </ng-template>
            </table>
          </div>
          <br>
          <br>
          <br>
          <h3 class="subtit">Additional Work Performed</h3>
          <div class="btn-toolbar pull-right">
            <div class="btn-group">     
              <ng-template #tipAddWork>Add Additional Work Performed</ng-template>
              <a [ngbTooltip]="tipAddWork"  class="btn btn-primary btn-sm btn-r-ound" href="javascript:;" 
                (click)="openFormModel('additional-work')"><i class="fa fa-plus"></i></a>
            </div>
          </div>
          <br>
          <br>
          <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    Crew Lead
                  </th>
                  <th>
                    Cost
                  </th>
                  <th>
                    Description
                  </th>
                  <th>
                    Notes
                  </th>
                  <th>
                    Completed Date
                  </th>
                  <th>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let additional of additionalFindings">
                  <td>
                    {{additional.crew.user_first_name}} {{additional.crew.user_last_name}}
                  </td>
                  <td>
                    <div style="text-align:left;">
                      {{additional.finding_bid_additional_work | currency}}
                    </div>
                  </td>
                  <td>
                    <div style="text-align:left;">
                      {{additional.finding_description_additional_work}}
                    </div>
                  </td>
                  <td>
                    {{additional.finding_notes_additional_work}}
                  </td>
                  <td>
                    {{additional.finding_completed_date_additional_work | date:'MM/dd/yyyy'}}
                  </td>
                  <td align="right">
                      <ng-template #tipDeleteItem>Delete Item</ng-template>
                    <a [ngbTooltip]="tipDeleteItem" href="javascript:;" class="btn btn-danger btn-sm btn-r-ound" (click)="onDeleteTask(additional.finding_additional_work_id, 'additional-finding-delete')">
                      <i class="fa fa-remove"></i>
                    </a>
                    <ng-template #tipeditItem>Edit Item</ng-template>&nbsp;
                    <a [ngbTooltip]="tipeditItem" class="btn btn-warning btn-sm btn-r-ound" href="javascript:;"
                      (click)="openEditFormModel('additional-work-edit',additional.finding_additional_work_id )"><i
                        class="fa fa-edit"></i></a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>
          <br>
          <h3 class="subtit">Crew Hours, Materials, and Sub Contractors</h3>
          <div class="btn-toolbar pull-right">
            <div class="btn-group">    
              <div style="float:right; display:inline; margin-right: 24px;">
                <ng-template #tipAddContractor>Add Sub Contractors</ng-template>
                <a [ngbTooltip]="tipAddContractor" class="btn btn-primary btn-sm btn-r-ound" href="javascript:;" 
                  (click)="openFormModel('sub-contractors')"><i class="fa fa-plus"></i></a> Sub Contractors
              </div>
              <div style="float:right; display:inline; margin-right: 24px;">
                <ng-template #addChemicals>Add Chemicals</ng-template>
                <a [ngbTooltip]="addChemicals" class="btn btn-primary btn-sm btn-r-ound" href="javascript:;" 
                  (click)="openFormModel('chemicals')"><i class="fa fa-plus"></i></a> Add Chemicals
              </div>
              <div style="float:right; display:inline; margin-right: 24px;">
                  <ng-template #addMeterial>Add Materials</ng-template>
                <a [ngbTooltip]="addMeterial" class="btn btn-primary btn-sm btn-r-ound" href="javascript:;" 
                  (click)="openFormModel('materials')"><i class="fa fa-plus"></i></a> Materials
              </div>
              <div style="float:right; display:inline;margin-right: 24px;">
                  <ng-template #addChem>Add Chem Application Hours</ng-template>
                <a [ngbTooltip]="addChem" class="btn btn-primary btn-sm btn-r-ound" href="javascript:;" 
                  (click)="openFormModel('chem-application-hours')"><i class="fa fa-plus"></i></a> Chem Application
                Hours
              </div>
              <div style="float:right; display:inline; margin-right: 24px;">
                  <ng-template #addCrewHour>Add Crew Hours</ng-template>
                <a [ngbTooltip]="addCrewHour" class="btn btn-primary btn-sm btn-r-ound" href="javascript:;" 
                  (click)="openFormModel('crew-hours')"><i class="fa fa-plus"></i></a> Crew Hours
              </div>
              <div style="clear:both;">
              </div>
            </div>
          </div>
          <br>
          <br>
          <h4 class="subtit_tight">Materials</h4>
          <div class="table-responsive">
            <table class="table table-bordered  table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    Materials Cost
                  </th>
                  <th>
                    Date Used
                  </th>
                  <th>
                    Notes
                  </th>
                  <th>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let material of materialMeta">
                  <td>
                    ${{material.job_meta_materials_cost}}
                  </td>
                  <td>
                    {{material.job_meta_materials_date_used | date:'MM/dd/yyyy'}}
                  </td>
                  <td>
                    {{material.job_meta_materials_notes}}
                  </td>
                  <td align="right">
                    <ng-template #delete5>Delete Item</ng-template>
                    <a [ngbTooltip]="delete5"  href="javascript:;" class="btn btn-danger btn-sm btn-r-ound" (click)="onDeleteTask(material.job_meta_id,'material-delete')">
                      <i class="fa fa-remove"></i>
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <h4 class="subtit_tight">Additional Chemicals</h4>
          <div class="table-responsive">
            <table class="table  table-bordered  table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    Chemical
                  </th>
                  <th>
                    Amount
                  </th>
                  <th>
                    Unit
                  </th>
                  <th>
                    Cost
                  </th>
                  <th>
                    Date
                  </th>
                  <th>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let chemPlus of chemPlusMeta">
                  <td>
                    {{chemPlus.chemical.chemical_name}}
                  </td>
                  <td>
                    {{chemPlus.job_meta_chemical_amount}}
                  </td>
                  <td>
                    {{chemPlus.job_meta_chemical_unit}}
                  </td>
                  <td>
                    {{chemPlus.job_meta_chemical_cost | currency }}
                  </td>
                  <td>
                    {{chemPlus.job_meta_chemical_date | date:'MM/dd/yyyy'}}
                  </td>
                  <td align="right">
                    <ng-template #delete4>Delete Item</ng-template>
                    <a [ngbTooltip]="delete4"  href="javascript:;" class="btn btn-danger btn-sm btn-r-ound" (click)="onDeleteTask(chemPlus.job_meta_id,'chem-delete')">
                      <i class="fa fa-remove"></i>
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <h4 class="subtit_tight">Crew Hours</h4>
          <div class="table-responsive">
            <table class="table table-bordered  table-striped table-hover fill-head" style="font-size: 14px;">
              <thead>
                <tr>
                  <th>
                    Crew Mamber
                  </th>
                  <th>
                    Hours
                  </th>
                  <th>
                    Date Completed
                  </th>
                  <th>
                    Commission/Hourly Fees
                  </th>
                  <th>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let crew of crewMeta">
                  <td>
                    {{crew.crew.user_first_name}} {{crew.crew.user_last_name}}
                  </td>
                  <td>
                    <div id="job_meta_crew_hours_103">
                      {{crew.job_meta_crew_hours}}
                    </div>
                  </td>
                  <td>
                    {{crew.job_meta_crew_date_completed | date:'MM/dd/yyyy'}}
                  </td>
                  <td>
                    <span *ngIf="crew.job_meta_data; else job_meta">{{crew.job_meta_data}}</span>
                    <ng-template #job_meta>N/A</ng-template>
                  </td>
                  <td align="right">
                    <ng-template #delete1>Delete Item</ng-template>
                    <a [ngbTooltip]="delete1"  href="javascript:;" class="btn btn-danger btn-sm btn-r-ound" (click)="onDeleteTask(crew.job_meta_id,'crew-hours-delete')">
                      <i class="fa fa-remove"></i>
                    </a>
                  </td>
                </tr>
                <tr>
                  <td align="right">
                    Total Hours:
                  </td>
                  <td>
                    {{totalCrewHours}}
                  </td>
                  <td>
                  </td>
                  <td>
                  </td>
                  <td>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <h4 class="subtit_tight">Chemical Application Hours</h4>
          <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    Crew Member
                  </th>
                  <th>
                    Hours
                  </th>
                  <th>
                    Date Completed
                  </th>
                  <th>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let chem of chemMeta">
                  <td>
                    {{chem.crew.user_first_name}} {{chem.crew.user_last_name}}
                  </td>
                  <td>
                    <div id="job_meta_chem_hours_5890">
                      {{chem.job_meta_chem_hours}}
                    </div>
                  </td>
                  <td>
                    {{chem.job_meta_chem_date_completed | date:'MM/dd/yyyy'}}
                  </td>
                  <td align="right">
                    <ng-template #delete0>Delete Item</ng-template>
                    <a [ngbTooltip]="delete0"  href="javascript:;" class="btn btn-danger btn-sm btn-r-ound" (click)="onDeleteTask(chem.job_meta_id,'chem-app-hours-delete')">
                      <i class="fa fa-remove"></i>
                    </a>
                  </td>
                </tr>
                <tr>
                  <td align="right">
                    Total Hours:
                  </td>
                  <td>
                    {{totalchemHours}}
                  </td>
                  <td>
                  </td>
                  <td>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <h4 class="subtit_tight">Sub Contractors</h4>
          <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    Contractor
                  </th>
                  <th>
                    Cost
                  </th>
                  <th>
                    Date
                  </th>
                  <th>
                    Notes
                  </th>
                  <th>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let contractor of contractorMeta">
                  <td>
                    {{contractor.contractor.user_first_name}} {{contractor.contractor.user_last_name}}
                  </td>
                  <td>
                    {{contractor.job_meta_contractor_cost | currency}}
                  </td>
                  <td>
                    {{contractor.job_meta_contractor_date | date:'MM/dd/yyyy'}}
                  </td>
                  <td>
                    {{contractor.job_meta_contractor_notes}}
                  </td>
                  <td align="right">
                    <ng-template #delete3>Delete Item</ng-template>
                    <a [ngbTooltip]="delete3"   href="javascript:;" class="btn btn-danger btn-sm btn-r-ound" (click)="onDeleteTask(contractor.job_meta_id,'sub-contractor-delete')">
                      <i class="fa fa-remove"></i>
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <br>
          <br>
          <br>
          <div class="form-group row">
            <label class="col-sm-3 col-lg-2 control-label">Work Completion Report Notes:</label>
            <div class="col-sm-9 col-lg-6 controls">
              <div id="insert_tit3" style="text-align:center;" *ngIf="selector">
                (Press INSERT to open Code Selector)
              </div>
              <textarea (click)="onClickinside($event)" formControlName="job_completed_notes" (keydown)="lookupCode($event)" class="form-control" rows="3"
                ></textarea>
              <span class="help-inline"><i class="fa fa-question-circle"></i> Optional</span>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-sm-3 col-lg-2 control-label">Work Date Completed:</label>
            <div class="col-sm-5 col-lg-4 controls" style="padding-top: 0px;">
              <div class="input-group form-date-pick">
                <input formControlName="job_completed_date" class="form-control" placeholder="mm/dd/yyyy" name="dp"
                  firstDayOfWeek="7" ngbDatepicker #d="ngbDatepicker" (click)="d.toggle()" (dateSelect)="onDateSelect($event)">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button">
                    <i class="fa fa-calendar" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
              <div *ngIf="submitted && completionForm.get('job_completed_date').invalid" class="text-danger">
                <p *ngIf="completionForm.get('job_completed_date').hasError('required')">Work Date Completed is a
                  required field</p>
              </div>
              <span class="help-inline"><i class="fa fa-question-circle"></i> Optional. Default is date of Work
                Completion Update. Override by entering different date here.</span>
            </div>
          </div>
          <br>
          <div class="form-group row">
            <div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2">
              <input class="btn btn-primary" type="submit" value=" Update and Mark Findings as Completed ">
            </div>
          </div>
        </form>
      </ng-template>
    </div>
  </div>
